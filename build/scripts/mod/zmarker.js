(function(e){var t=function(e,n,r,i){var s=t.$||jQuery,o=s(window),u=s(document),a=s(i.currentTarget),f,l,c;l=function(){var t=[],i,l,h=a.offset().top,p=a.offset().left,d=a.outerWidth(),v=a.outerHeight(),m=o.width(),g=o.height();s(".mk").remove(),s("body").append('<div class="mk '+n.substr(1)+'"><div class="mkr-bg"></div><div class="mkr-ct">'+e+"</div></div>"),f=s(".mk"),s(".mkr-bg").width(f.outerWidth()).height(f.outerHeight()),i=f.outerWidth(),l=f.outerHeight(),t=[h+v,p+d,h+v+l-u.scrollTop(),p+d+i-u.scrollLeft()],t[3]>m&&(t[1]=p-i),t[2]>g&&(t[0]=h-l),f.css({top:t[0],left:t[1]}),r&&c()},t.mEnd=function(){u.off("click.mk"),document.body.style.MozUserSelect="-moz-all",document.body.onselectstart=function(){return!0},document.body.ondragstart=function(){return!0},s(".mk").remove()},c=function(){document.body.style.MozUserSelect="none",document.body.onselectstart=function(){return!1},document.body.ondragstart=function(){return!1},f.css("cursor","move").on("mousedown",function(){u.on("mousemove.mk",function(e){f.css({top:e.pageY-20,left:e.pageX-20})}),s(this).on("mouseup.mk",function(){u.off("mousemove.mk"),s(this).off("mouseup.mk")})})},i.type==="click"&&u.off("click.mk").on("click.mk",function(e){if(e.target===a[0])l();else if(s(e.target)[0]===s(".msend")[0])e.preventDefault(),typeof t.todo=="function"&&t.todo(),t.mEnd();else if(s(e.target)[0]===s(".mend")[0])e.preventDefault(),t.mEnd();else{if(s(e.target).parents(".mk")[0]!==undefined||s(e.target)[0]===s(".mk")[0])return;t.mEnd()}}),i.type==="mouseover"&&(l(),s(i.currentTarget).on("mouseout",function(){t.mEnd()}))};typeof e=="function"&&e.amd?e("zmarker",["jquery"],function(e){return t.$=e,t}):window.zmarker=t})(window.define);